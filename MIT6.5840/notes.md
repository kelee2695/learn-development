# 6.5840 分布式系统
## Lecture 0
### 分布式系统概念
一个分布式系统是由多个独立的计算机（通常称为节点，Node）​​ 组成的集合，这些节点通过网络连接和消息传递进行通信与协调，从而对外作为一个统一的、连贯的系统提供服务或完成共同的任务。
### 分布式系统内涵
![分布式系统内涵](picture/distributed_system.png "分布式系统内涵")
分布式系统的世界远不止于“计算”。它是一个丰富的工具箱，提供了各种模式来解决不同维度的问题：
​解决资源问题​：用 ​分布式资源（IaaS）​​
​解决算力问题​：用 ​分布式计算（Hadoop）​​
​解决复杂度问题​：用 ​分布式协作（微服务）​​
​解决数据存储规模问题​：用 ​分布式数据（Database）​​
​解决网络效率与信任问题​：用 ​分布式网络（CDN/区块链）​​
​解决AI数据隐私和规模问题​：用 ​分布式智能（联邦学习）​​
​解决多用户互动问题​：用 ​分布式应用（协作工具/游戏）​​
所有这些都共享着分布式系统的核心思想：​通过消息传递，让多个独立的组件协同工作，从而达成一个共同的目标，并以此获得单机系统无法比拟的优势。
#### KVM等虚拟化技术在此体系中的地位
KVM等虚拟化技术可将物理主机一虚多，主要用于提供虚拟化的服务器节点（服务器节点可组成分布式系统）。使用这种虚拟化技术管理，可以解决分布式资源的问题。
#### k8s在此体系中的地位
k8s不属于上述任何一个维度，k8s是一个使用分布式的资源（服务器node集群提供的分布式资源，其中服务器node集群可以是物理机，也可以是IaaS提供的虚拟机集群）构建分布式系统（由多个pod组成的分布式系统）的管理平台。
## Lecture 1
### Hadoop
Hadoop ：是使用 Java 编写，允许分布在集群，使用简单的编程模型的计算机大型数据集处理的Apache 的开源框架。
### MapReduce
MapReduce 是一个分布式运算程序的编程框架，是用户开发“基于 Hadoop 的数据分析应用”的核心框架。 MapReduce 核心功能是将用户编写的业务逻辑代码和自带默认组件整合成一个完整的分布式运算程序，并发运行在一个 Hadoop 集群上。
#### 用户角度
用户角度需要实现map与reduce两个函数。
map函数：将输入的key-value对映射为中间的key-value对列表。
reduce函数：将具有相同key的中间的key-value对列表归并为输出的key-value对。
在map函数中，输入的键值对为原始数据，中间键值对是map函数对原始数据进行了一定的计算，并对计算结果进行了分类。其中分类就是中间键值对的键。分类指定该计算结果由哪一个reduce函数处理。
在reduce函数中，输入的键值对列表是map函数输出的中间键值对列表中，键相同的那些键值对。reduce函数需要将这些键值对进行归并，输出为最终的键值对。最终的键值对的键，也是map函数分类产生的键。（因为reduce函数会对每一个map出的类生成一个结果。）
上述论证意味着，mapreduce框架的设计过程为：
1. 将大段的、无头绪的数据转化为一条一条的记录。（如大量文本转化为一条一条的词频，大量请求记录转化为一条一条的请求记录）
2. 其中一条一条的概念是指每一个中间键值对的组（以键分组）生成一条数据。
3. map函数用于从原始数据得到中间键值对。
4. reduce函数用于从中间键值对列表得到最终的键值对。
#### mapreduce开发人员角度
![mapreduce工作流程](picture/mapreduce_process.jpg "mapreduce工作流程")
### 分布式文件系统HDFS（分布式“硬盘”）
现代企业环境中，单机无法存储大量的数据，需要跨机器存储。
同一管理分布在集群上的文件系统为分布式文件系统。
传统的网络文件系统（NFS）也是分布式文件系统，但是文件只存储于单机，无可靠性保证。操作复杂，存在拉取，修改，上传等操作。存在单点性能压力。
HDFS，是Hadoop Distributed File System的简称，是Hadoop抽象文件系统的一种实现。
HDFS的文件分布在集群机器上，同时提供副本进行容错及可靠性保证。例如客户端写入读取文件的直接操作都是分布在集群各个机器上的，没有单点性能压力。
HDFS 由​NameNode与DataNode组成，NameNode 负责管理文件系统的命名空间​（Namespace），如文件的目录结构、权限信息，以及记录每个文件由哪些数据块组成、这些数据块分布在哪些 DataNode 上。​DataNode​是实际存储数据块的工作节点。它们负责处理文件系统客户端的读写请求，执行数据块的创建、删除和复制等操作。
DataNode 会定期向 NameNode 发送心跳信号​（Heartbeat）和块报告​（Block Report），以汇报自身健康状况和存储的数据块列表
。NameNode 依此判断 DataNode 是否存活以及数据块的状态。
HDFS ​数据上传流程​：客户端将文件分块后，从 NameNode 获取存储位置，并通过管道式写入将数据块传输至多个 DataNode 完成存储和副本复制。
HDFS ​数据下载流程​：客户端从 NameNode 获取文件元数据（包含数据块位置），然后并行从多个 DataNode 读取数据块，最终在本地组装成完整文件。
高容错性​：HDFS 通过数据分块和多副本机制实现容错。文件被切分成块（默认128MB），每个块复制多个副本（默认3个）并分布在不同节点甚至不同机架上。
高吞吐量​：HDFS 优化了大规模数据的批量读写吞吐率，具有文件分块存储的特点，不存在单点性能压力。
### YARN
YARN ：是 Hadoop 2.0 引入的资源管理和作业调度系统。它将 Hadoop 集群的资源（如 CPU、内存）抽象为统一的资源池，并负责管理和分配这些资源给运行在集群上的应用程序。
### MapReduce: Simplified Data Processing on Large Clusters
Mapreduce 核心原理是分而治之，将复杂的任务分解为多个简单的任务，并行执行，最后合并结果。

